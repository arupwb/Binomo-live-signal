<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Binomo Live Signal ‚Äî Forex + Crypto IDX</title>
<style>
  :root{
    --bg:#07101a;--card:#0f1724;--muted:#9fb3c9;--accent:#7ee3b5;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:#e6eef8;font-family:Arial,Helvetica,sans-serif;display:flex;align-items:center;justify-content:center;min-height:100vh;padding:18px}
  .card{width:100%;max-width:820px;background:var(--card);border-radius:12px;padding:18px;box-shadow:0 12px 40px rgba(0,0,0,.6)}
  h1{margin:0 0 10px;color:var(--accent);font-size:20px}
  label,select,input,button{display:block;width:100%;box-sizing:border-box}
  select,input{padding:10px;border-radius:8px;border:1px solid #263244;background:#07101a;color:#e6eef8;margin:8px 0}
  button{padding:10px;border-radius:8px;border:none;background:var(--accent);color:#022;font-weight:700;cursor:pointer}
  .signal{font-size:22px;padding:14px;border-radius:8px;margin-top:10px;text-align:center}
  .up{background:#04260f;color:#9cf7c7}
  .down{background:#2b0e10;color:#ffc4c4}
  .none{background:#172029;color:var(--muted)}
  .meta{font-size:13px;color:var(--muted);margin-top:8px}
  .row{display:flex;gap:10px;margin-top:12px}
  .row button{flex:1}
  .small{font-size:12px;color:#6f8aa0;margin-top:12px}
  .note{background:#071826;padding:10px;border-radius:6px;margin-top:12px;font-size:13px;color:var(--muted)}
  @media (max-width:480px){ .card{padding:14px} h1{font-size:18px} .signal{font-size:18px} }
</style>
</head>
<body>
  <div class="card">
    <h1>Binomo Live Signal ‚Äî Forex + Crypto IDX</h1>

    <div id="loginArea">
      <input id="pass" type="password" placeholder="Enter password"/>
      <button id="loginBtn">Unlock</button>
      <p class="small">Password: <strong>Digi33737</strong></p>
      <p id="loginError" style="color:#ffb4b4"></p>
    </div>

    <div id="app" style="display:none">
      <label for="pair">Select pair</label>
      <select id="pair">
        <option value="EUR/USD">EUR/USD</option>
        <option value="GBP/USD">GBP/USD</option>
        <option value="USD/JPY">USD/JPY</option>
        <option value="EUR/JPY">EUR/JPY</option>
        <option value="AUD/USD">AUD/USD</option>
        <option value="USD/CHF">USD/CHF</option>
        <option value="USD/CAD">USD/CAD</option>
        <option value="NZD/USD">NZD/USD</option>
        <option value="GBP/JPY">GBP/JPY</option>
        <option value="EUR/GBP">EUR/GBP</option>
        <option value="AUD/JPY">AUD/JPY</option>
        <option value="CRYPTOIDX">Crypto IDX</option>
      </select>

      <div id="signalBox" class="signal none">Waiting...</div>
      <div class="meta" id="meta">Last update: --:--:--</div>

      <div class="row">
        <button id="refresh">Refresh Now</button>
        <button id="autoToggle">Auto: Off</button>
      </div>

      <div class="note">
        <strong>Notes:</strong>
        <ul style="margin:6px 0 0 18px;padding:0;color:var(--muted)">
          <li>Real data via TwelveData API (1min). Local file:// may block API calls ‚Äî host on GitHub Pages/Netlify/Vercel.</li>
          <li>Crypto IDX uses a deterministic synthetic fallback if API doesn't return the index.</li>
          <li>Use demo account first to verify signals before real money trades.</li>
        </ul>
      </div>
    </div>
  </div>

<script>
/* ====== CONFIG ====== */
const PASSWORD = "Digi33737";
const API_KEY = "e698ce6b1336445bb18f5ded992a1b77"; // embedded
const AUTO_REFRESH_MS = 30000; // 30s
const ACTIVE_START_HOUR = 7; // local time
const ACTIVE_END_HOUR = 23;  // local time
/* =================== */

const loginBtn = document.getElementById('loginBtn');
const passInput = document.getElementById('pass');
const loginError = document.getElementById('loginError');
const loginArea = document.getElementById('loginArea');
const appEl = document.getElementById('app');
const pairSel = document.getElementById('pair');
const signalBox = document.getElementById('signalBox');
const metaEl = document.getElementById('meta');
const refreshBtn = document.getElementById('refresh');
const autoBtn = document.getElementById('autoToggle');

let autoTimer = null;
let autoOn = false;

loginBtn.addEventListener('click', () => {
  if(passInput.value === PASSWORD) {
    loginArea.style.display = 'none';
    appEl.style.display = 'block';
    startAuto();
    fetchAndShow();
  } else {
    loginError.textContent = 'Incorrect password';
  }
});

refreshBtn.addEventListener('click', fetchAndShow);
pairSel.addEventListener('change', fetchAndShow);
autoBtn.addEventListener('click', ()=> {
  autoOn = !autoOn;
  autoBtn.textContent = autoOn ? 'Auto: On' : 'Auto: Off';
  if(autoOn){ startAuto(); fetchAndShow(); } else { stopAuto(); }
});

function startAuto(){ stopAuto(); autoTimer = setInterval(fetchAndShow,AUTO_REFRESH_MS); }
function stopAuto(){ if(autoTimer){ clearInterval(autoTimer); autoTimer=null; } }

function isMarketOpen(now){
  const h = now.getHours();
  if(ACTIVE_START_HOUR <= ACTIVE_END_HOUR) return h >= ACTIVE_START_HOUR && h < ACTIVE_END_HOUR;
  return h >= ACTIVE_START_HOUR || h < ACTIVE_END_HOUR;
}

async function fetchAndShow(){
  const pair = pairSel.value;
  const now = new Date();
  if(!isMarketOpen(now)){
    showResult({text:'Market Closed', cls:'none', info:''}, now);
    return;
  }

  signalBox.className = 'signal none';
  signalBox.textContent = 'Fetching...';
  metaEl.textContent = 'Last update: --:--:--';

  try {
    if(pair === 'CRYPTOIDX'){
      // synthetic fallback for Crypto IDX
      const res = generateSyntheticIDX(now);
      displayResult(res, now, false, true);
      return;
    }

    const symbol = pair.replace('/','');
    const url = `https://api.twelvedata.com/time_series?symbol=${encodeURIComponent(symbol)}&interval=1min&outputsize=30&apikey=${API_KEY}`;

    const resp = await fetch(url);
    const data = await resp.json();
    if(!data || !data.values){
      // fallback synthetic
      const res = generateSyntheticPair(pair, now);
      displayResult(res, now, true);
      return;
    }

    // API values: oldest first -> reverse to newest-first
    const closes = data.values.map(v => parseFloat(v.close)).reverse();

    const ma5 = sma(closes,5);
    const ma20 = sma(closes,20);
    const rsiVal = rsi(closes,14);

    const sig = makeSignalFromIndicators(ma5, ma20, rsiVal);
    displayResult({text:sig.text, cls:sig.cls, info:`MA5:${fmt(ma5)} MA20:${fmt(ma20)} RSI:${Math.round(rsiVal)}`}, now, false);
  } catch(err){
    console.error(err);
    const res = generateSyntheticPair(pair, now);
    displayResult(res, now, true);
  }
}

function displayResult(res, now, synthetic=false, isIdxFallback=false){
  signalBox.className = 'signal ' + (res.cls || 'none');
  signalBox.textContent = res.text || '‚è∏ No Trade';
  metaEl.textContent = `Updated: ${now.toLocaleTimeString()} ${synthetic? '| (synthetic fallback)':''} ${res.info? '| '+res.info : ''}`;
}

/* ===== indicators ===== */
function sma(arr, period){
  if(!arr || arr.length < period) return null;
  const s = arr.slice(0,period).reduce((a,b)=>a+b,0);
  return s/period;
}
function rsi(prices, period=14){
  if(!prices || prices.length <= period) return 50;
  let gains=0, losses=0;
  for(let i=0;i<period;i++){
    const diff = prices[i] - prices[i+1];
    if(diff>0) gains+=diff; else losses+=Math.abs(diff);
  }
  const avgGain = gains/period;
  const avgLoss = (losses||0.00001)/period;
  const rs = avgGain/avgLoss;
  return 100 - (100/(1+rs));
}
function makeSignalFromIndicators(ma5, ma20, rsiVal){
  if(ma5 && ma20){
    if(ma5 > ma20 && rsiVal >=45 && rsiVal <=70) return {text:'üîº BUY / CALL', cls:'up'};
    if(ma5 < ma20 && rsiVal >=30 && rsiVal <=55) return {text:'üîΩ SELL / PUT', cls:'down'};
  }
  return {text:'‚è∏ No Trade', cls:'none'};
}
function fmt(x){ return x? x.toFixed(5) : '-'; }

/* ===== synthetic fallback ===== */
function seedFromString(s){
  let h = 2166136261 >>> 0;
  for(let i=0;i<s.length;i++){ h ^= s.charCodeAt(i); h += (h<<1)+(h<<4)+(h<<7)+(h<<8)+(h<<24); }
  return h >>> 0;
}
function xorshift32(seed){ seed ^= seed << 13; seed ^= seed >>> 17; seed ^= seed << 5; return seed >>> 0; }
function generateSyntheticPrices(key, length=60){
  let seed = seedFromString(key);
  const arr=[];
  let price = 1 + ((seed % 1000)/1000);
  for(let i=0;i<length;i++){
    seed = xorshift32(seed);
    const change = ((seed % 1000)/100000) - 0.003;
    price = Math.max(0.0001, price * (1 + change));
    arr.push(price);
  }
  return arr;
}
function generateSyntheticPair(pair, now){
  const key = pair + '|' + now.getFullYear() + '-' + now.getMonth() + '-' + now.getDate() + '|' + now.getHours() + ':' + now.getMinutes();
  const prices = generateSyntheticPrices(key,60);
  const ma5 = sma(prices,5), ma20 = sma(prices,20), rsiVal = rsi(prices,14);
  const sig = makeSignalFromIndicators(ma5,ma20,rsiVal);
  return {text:sig.text, cls:sig.cls, info:`MA5:${fmt(ma5)} MA20:${fmt(ma20)} RSI:${Math.round(rsiVal)}`};
}
function generateSyntheticIDX(now){
  const key = 'CRYPTOIDX|' + now.getFullYear() + '-' + now.getMonth() + '-' + now.getDate() + '|' + now.getHours() + ':' + now.getMinutes();
  return generateSyntheticPair(key, now);
}

/* ===== helpers ===== */
function showError(text){
  signalBox.className = 'signal none';
  signalBox.textContent = text;
  metaEl.textContent = '';
}

/* expose for testing */
window.fetchAndShow = fetchAndShow;
</script>
</body>
</html>
